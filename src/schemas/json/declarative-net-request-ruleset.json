{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://json.schemastore.org/declarative-net-request-ruleset.json",
  "type": "array",
  "description": "A Collection of rules defined with the \"declarative_net_request\" manifest key and stored in the extension. An extension can enable and disable static rulesets using updateEnabledRulesets. The set of enabled static rulesets is persisted across sessions but not across extension updates. The static rulesets enabled on extension installation and update are determined by the content of the \"declarative_net_request\" manifest key.\n\nItem number limited by MAX_NUMBER_OF_STATIC_RULESETS https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/MAX_NUMBER_OF_STATIC_RULESETS\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest#rulesets",
  "maxItems": 50,
  "definitions": {
    "stringArray": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "canonicalDomain": {
      "$ref": "#/definitions/stringArray",
      "items": {
        "$comment": "https://regexr.com/8b9gm",
        "pattern": "^(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)|(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z]{2,63}|((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}|\\[(?:[0-9a-f]{0,4}:){2,7}[0-9a-f]{0,4}\\])$",
        "description": "Domains specified in initiatorDomains, excludedInitiatorDomains, requestDomains, or excludedRequestDomains should comply with the following:\n\nSub-domains such as \"a.example.com\" are allowed.\nThe entries must consist of only lowercase ASCII characters.\nUse Punycode encoding for internationalized domains.\nIPv4 addresses must be represented as 4 numbers separated by a dot.\nIPv6 addresses should be represented in their canonical form, wrapped in square brackets.\n\nTo programmatically generate the canonical domain for a URL, use the URL API and read its hostname property, i.e., new URL(url).hostname.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#canonical_domain"
      }
    },
    "requestMethod": {
      "$comment": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods",
      "oneOf": [
        {
          "const": "GET",
          "description": "The GET method requests a representation of the specified resource. Requests using GET should only retrieve data and should not contain a request content.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET"
        },
        {
          "const": "HEAD",
          "description": "The HEAD method asks for a response identical to a GET request, but without a response body.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD"
        },
        {
          "const": "POST",
          "description": "The POST method submits an entity to the specified resource, often causing a change in state or side effects on the server.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST"
        },
        {
          "const": "PUT",
          "description": "The PUT method replaces all current representations of the target resource with the request content.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT"
        },
        {
          "const": "DELETE",
          "description": "The DELETE method deletes the specified resource.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/DELETE"
        },
        {
          "const": "CONNECT",
          "description": "The CONNECT method establishes a tunnel to the server identified by the target resource.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/CONNECT"
        },
        {
          "const": "OPTIONS",
          "description": "The OPTIONS method describes the communication options for the target resource.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS"
        },
        {
          "const": "TRACE",
          "description": "The TRACE method performs a message loop-back test along the path to the target resource.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/TRACE"
        },
        {
          "const": "PATCH",
          "description": "The PATCH method applies partial modifications to a resource.\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PATCH"
        }
      ]
    },
    "resourceType": {
      "$comment": "https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType",
      "oneOf": [
        {
          "const": "beacon",
          "description": "Requests sent through the Beacon API.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#beacon"
        },
        {
          "const": "csp_report",
          "description": "Requests sent to the report-uri given in the Content-Security-Policy header, when an attempt to violate the policy is detected.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#csp_report"
        },
        {
          "const": "font",
          "description": "Web fonts loaded for a @font-face CSS rule.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#font"
        },
        {
          "const": "image",
          "description": "Resources loaded to be rendered as image, except for imageset on browsers that support that type (see browser compatibility below).\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#image"
        },
        {
          "const": "imageset",
          "description": "Images loaded by a <picture> element or given in an <img> element's srcset attribute.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#imageset"
        },
        {
          "const": "main_frame",
          "description": "Top-level documents loaded into a tab.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#main_frame"
        },
        {
          "const": "media",
          "description": "Resources loaded by a <video> or <audio> element.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#media"
        },
        {
          "const": "object",
          "description": "Resources loaded by an <object> or <embed> element.\nBrowsers that don't have a dedicated object_subrequest type (see browser compatibility below), also label subsequent requests sent by the plugin as object.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#object"
        },
        {
          "const": "object_subrequest",
          "description": "Requests sent by plugins.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#object_subrequest"
        },
        {
          "const": "ping",
          "description": "Requests sent to the URL given in a hyperlink's ping attribute, when the hyperlink is followed.\nBrowsers that don't have a dedicated beacon type (see browser compatibility below), also label requests sent through the Beacon API as ping.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#ping"
        },
        {
          "const": "script",
          "description": "Code that is loaded to be executed by a <script> element or running in a Worker.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#script"
        },
        {
          "const": "speculative",
          "description": "In a speculative connection, the browser has determined that a request to a URI may be coming soon, so it starts a TCP and/or TLS handshake immediately, so it is ready more quickly when the resource is actually requested. Note that this type of connection does not provide valid tab information, so request details such as tabId, frameId, parentFrameId, etc. are inaccurate.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#speculative"
        },
        {
          "const": "stylesheet",
          "description": "CSS stylesheets loaded to describe the representation of a document.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#stylesheet"
        },
        {
          "const": "sub_frame",
          "description": "Documents loaded into an <iframe> or <frame> element.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#sub_frame"
        },
        {
          "const": "web_manifest",
          "description": "Web App Manifests loaded for websites that can be installed to the homescreen.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#web_manifest"
        },
        {
          "const": "webbundle",
          "description": "Requests initiating a connection to a server through a Web Bundle or packaged website.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#webbundle"
        },
        {
          "const": "websocket",
          "description": "Requests initiating a connection to a server through the WebSocket API.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#websocket"
        },
        {
          "const": "webtransport",
          "description": "Requests initiating a connection to a server through the WebTransport API.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#webtransport"
        },
        {
          "const": "xml_dtd",
          "description": "DTDs loaded for an XML document.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#xml_dtd"
        },
        {
          "const": "xmlhttprequest",
          "description": "Requests sent by an XMLHttpRequest object or through the Fetch API.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#xmlhttprequest"
        },
        {
          "const": "xslt",
          "description": "XSLT stylesheets loaded for transforming an XML document.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#xslt"
        },
        {
          "const": "other",
          "description": "Resources that aren't covered by any other available type.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType#other"
        }
      ]
    },
    "headerInfo": {
      "type": "object",
      "description": "The response header to match for the request, declared in the rule.condition.excludedResponseHeaders array or rule.condition.responseHeaders array. If specified, the array must be non-empty.\nWhen used in the condition responseHeaders, the rule matches if the request matches this response header condition. When used in the condition excludedResponseHeaders, the rule does not match if the request matches this response header condition.\nEach object describes one header to match or exclude. To check multiple headers, multiple objects can be specified in these arrays, or across multiple rules.\n\nNote: Matching by headers is a relatively new feature. Make sure to feature-detect its availability before relying on it. While some browsers ignore the complete rule when an unrecognized condition is present, Chrome 121 until 127 applied the whole rule while ignoring theresponseHeaders condition. This could result in matching more requests than intended, see Chromium issue 347186592.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/HeaderInfo",
      "required": ["header"],
      "properties": {
        "header": {
          "type": "string",
          "description": "The name of the header. This condition matches on the name only if both values and excludedValues are not specified.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/HeaderInfo#header"
        },
        "values": {
          "$ref": "#/definitions/stringArray",
          "description": "If specified, this condition matches if the header's value matches at least one pattern in this list. This supports case-insensitive header value matching plus the following constructs:\n\n'*' : Matches any number of characters.\n'?' : Matches zero or one character(s).\n'*' and '?' can be escaped with a backslash, e.g. '\\*' and '\\?'.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/HeaderInfo#values"
        },
        "excludedValues": {
          "$ref": "#/definitions/stringArray",
          "description": "If specified, this condition is not matched if the header exists but its value contains at least one element in this list. This uses the same glob pattern syntax as values. If values and excludedValues are both matched, then excludedValues takes precedence.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/HeaderInfo#excludedValues"
        }
      }
    },
    "tabId": {
      "oneOf": [
        {
          "type": "integer",
          "minimum": 0
        },
        {
          "$comment": "Value found in https://chromium.googlesource.com/chromium/src/+/master/chrome/common/extensions/api/tabs.json#151",
          "const": -1,
          "description": "tabs.TAB_ID_NONE\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/TAB_ID_NONE"
        }
      ]
    },
    "chromeAppendableHeader": {
      "enum": [
        "Accept",
        "Accept-Encoding",
        "Accept-Language",
        "Access-Control-Request-Headers",
        "Cache-Control",
        "Connection",
        "Content-Language",
        "Cookie",
        "Forwarded",
        "If-Match",
        "If-None-Match",
        "Keep-Alive",
        "Range",
        "Te",
        "Trailer",
        "Transfer-Encoding",
        "Upgrade",
        "Via",
        "Want-Digest",
        "X-Forwarded-For"
      ]
    }
  },
  "items": {
    "type": "object",
    "required": ["id"],
    "properties": {
      "id": {
        "type": "number",
        "description": "An ID that uniquely identifies a rule within a ruleset. Mandatory and should be >= 1"
      },
      "priority": {
        "type": "number",
        "description": "The rule priority. When specified, it should be >= 1. Defaults to 1. See Matching precedence for details on how priority affects which rules are applied.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest#matching_precedence",
        "default": 1,
        "minimum": 1
      },
      "condition": {
        "type": "object",
        "description": "The condition under which this rule is triggered.",
        "properties": {
          "domainType": {
            "type": "string",
            "description": "Specifies whether the network request is first-party or third-party. The request is considered first-party if it's for the same domain as the document or subdocument that initiates the request. Otherwise, it's considered third-party. If omitted, all requests are accepted.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#domaintype",
            "enum": ["first-party", "third-party"]
          },
          "domains": {
            "$ref": "#/definitions/stringArray",
            "deprecated": true,
            "items": {
              "$ref": "#/definitions/canonicalDomain"
            },
            "description": "Use initiatorDomains instead. The rule only matches network requests originating from this list of domains.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#domains"
          },
          "excludedDomains": {
            "$ref": "#/definitions/stringArray",
            "deprecated": true,
            "items": {
              "$ref": "#/definitions/canonicalDomain"
            },
            "description": "Use excludedInitiatorDomains instead. The rule does not match network requests originating from this list of domains.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#excludeddomains"
          },
          "initiatorDomains": {
            "$ref": "#/definitions/stringArray",
            "items": {
              "$ref": "#/definitions/canonicalDomain"
            },
            "description": "The rule only matches network requests originating from this list of domains. If the list is omitted, the rule is applied to requests from all domains. An empty list is not allowed. This matches against the request initiator and not the request URL.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#initiatordomains"
          },
          "excludedInitiatorDomains": {
            "$ref": "#/definitions/stringArray",
            "items": {
              "$ref": "#/definitions/canonicalDomain"
            },
            "description": "The rule does not match network requests originating from this list of domains. If the list is empty or omitted, no domains are excluded. This takes precedence over initiatorDomains. This matches against the request initiator and not the request URL.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#excludedinitiatordomains"
          },
          "isUrlFilterCaseSensitive": {
            "type": "boolean",
            "description": "Whether the urlFilter or regexFilter (whichever is specified) is case sensitive. While there is consensus on defaulting to false across browsers in WECG issue 269, the value used to be true in (older) versions of Chrome and Safari. See Browser compatibility for details.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#isurlfiltercasesensitive",
            "default": false
          },
          "requestDomains": {
            "$ref": "#/definitions/stringArray",
            "items": {
              "$ref": "#/definitions/canonicalDomain"
            },
            "description": "The rule only matches network requests when the domain matches one from this list. If the list is omitted, the rule is applied to requests from all domains. An empty list is not allowed.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#requestdomains"
          },
          "excludedRequestDomains": {
            "$ref": "#/definitions/stringArray",
            "items": {
              "$ref": "#/definitions/canonicalDomain"
            },
            "description": "The rule does not match network requests when the domains matches one from this list. If the list is empty or omitted, no domains are excluded. This takes precedence over requestDomains.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#excludedrequestdomains"
          },
          "responseHeaders": {
            "$ref": "#/definitions/stringArray",
            "description": "The rule matches if the request matches any response header condition in this list (if specified).\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#responseheaders",
            "items": {
              "$ref": "#/definitions/headerInfo"
            }
          },
          "excludedResponseHeaders": {
            "$ref": "#/definitions/stringArray",
            "description": "he rule does not match if the request matches any response header condition in this list (if specified). If both excludedResponseHeaders and responseHeaders are specified, then the excludedResponseHeaders property takes precedence.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#responseheaders",
            "items": {
              "$ref": "#/definitions/headerInfo"
            }
          },
          "tabIds": {
            "type": "array",
            "description": "List of tabs.Tab.id that the rule should match. An ID of tabs.TAB_ID_NONE matches requests that don't originate from a tab. An empty list is not allowed. Only supported for session-scoped rules.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#tabids",
            "items": {
              "$ref": "#/definitions/tabId"
            }
          },
          "excludedTabIds": {
            "type": "array",
            "description": "List of tabs.Tab.id that the rule should not match. An ID of tabs.TAB_ID_NONE excludes requests that do not originate from a tab. Only supported for session-scoped rules.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#excludedtabids",
            "items": {
              "$ref": "#/definitions/tabId"
            }
          }
        },
        "allOf": [
          {
            "oneOf": [
              {
                "properties": {
                  "regexFilter": {
                    "type": "string",
                    "description": "Regular expression to match against the network request URL. Note that:\n\nThe supported format is not stable and varies across browsers, see \"Regular expressions in DNR API (regexFilter)\" in WECG issue 344 for details.\nThe regexFilter must be composed of only ASCII characters. This is matched against a URL where the host is encoded in the punycode format (in case of internationalized domains) and any other non-ascii characters are percent-encoded in UTF-8.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#regexfilter"
                  }
                }
              },
              {
                "properties": {
                  "urlFilter": {
                    "description": "The pattern that is matched against the network request URL. Supported constructs:\n\n* : Wildcard: Matches any number of characters.\n| : Left or right anchor: If used at either end of the pattern, specifies the beginning or end of the URL respectively.\n|| : Domain name anchor: If used at the beginning of the pattern, specifies the start of a (sub-)domain of the URL.\n^ : Separator character: This matches anything except a letter, a digit, or one of _, -, ., or %. The last ^ may also match the end of the URL instead of a separator character.\n\nurlFilter is composed of the following parts: (optional left/domain name anchor) + pattern + (optional right anchor). If omitted, all URLs are matched. An empty string is not allowed. A pattern beginning with ||* is not allowed. Use * instead. Note that:\nThe urlFilter must be composed of only ASCII characters. This is matched against a URL where the host is encoded in the punycode format (in case of internationalized domains) and any other non-ASCII characters are percent-encoded in UTF-8. For example, when the request URL is http://abc.рф?q=ф, the urlFilter is matched against the URL http://abc.xn--p1ai/?q=%D1%84.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#urlfilter"
                  }
                }
              }
            ]
          },
          {
            "oneOf": [
              {
                "properties": {
                  "requestMethods": {
                    "$ref": "#/definitions/stringArray",
                    "description": "List of HTTP request methods that the rule matches. An empty list is not allowed. Specifying a requestMethods rule condition also excludes non-HTTP(s) requests, whereas specifying excludedRequestMethods does not.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#requestmethods",
                    "items": {
                      "$ref": "#/definitions/requestMethod"
                    }
                  }
                }
              },
              {
                "properties": {
                  "excludedRequestMethods": {
                    "$ref": "#/definitions/stringArray",
                    "description": "List of request methods that the rule does not match on. Only one of requestMethods and excludedRequestMethods should be specified. If neither of them is specified, all request methods are matched.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#excludedrequestmethods",
                    "items": {
                      "$ref": "#/definitions/requestMethod"
                    }
                  }
                }
              }
            ]
          },
          {
            "oneOf": [
              {
                "properties": {
                  "resourceTypes": {
                    "type": "array",
                    "description": "List of resource types that the rule matches with. An empty list is not allowed. This must be specified for \"allowAllRequests\" rules and may only include the \"sub_frame\" and \"main_frame\" resource types.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#resourcetypes",
                    "items": {
                      "$ref": "#/definitions/resourceType"
                    }
                  }
                }
              },
              {
                "properties": {
                  "excludedResourceTypes": {
                    "type": "array",
                    "description": "List of resource types that the rule does not match on. Only one of resourceTypes and excludedResourceTypes should be specified. If neither of them is specified, all resource types except \"main_frame\" are blocked.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleCondition#excludedresourcetypes",
                    "items": {
                      "$ref": "#/definitions/resourceType"
                    }
                  }
                }
              }
            ]
          }
        ]
      },
      "action": {
        "type": "object",
        "description": "Details of the action to take if a rule is matched, as the action property of a declarativeNetRequest.Rule.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleAction",
        "required": ["type"],
        "if": {
          "properties": {
            "type": {
              "const": "redirect"
            }
          }
        },
        "then": {
          "properties": {
            "redirect": {
              "description": "Details describing how a redirect should be performed.\nNote: A redirect action does not redirect the request, and the request continues as usual when:\n\nthe action does not change the request.\nthe redirect URL is invalid (e.g., the value of regexSubstitution is not a valid URL).\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/Redirect",
              "properties": {
                "extensionPath": {
                  "type": "string",
                  "description": "The path relative to the extension directory. Should start with '/'. The initiator of the request can only follow the redirect when the resource is listed in web_accessible_resources.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/Redirect#extensionPath"
                },
                "regexSubstitution": {
                  "type": "string",
                  "description": " The substitution pattern for rules that specify a regexFilter. The first match of regexFilter within the URL is replaced with this pattern. Within regexSubstitution, backslash-escaped digits (\\1 to \\9) are used to insert the corresponding capture groups. \\0 refers to the entire matching text.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/Redirect#regexSubstitution"
                },
                "transform": {
                  "type": "object",
                  "description": "Details describing a URL transformation to perform for a redirect rule.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/Redirect#transform",
                  "properties": {
                    "fragment": {
                      "$comment": "https://regexr.com/8b9io",
                      "type": "string",
                      "description": "The new fragment for the request. Should be either empty, in which case the existing fragment is cleared; or should begin with '#'.'\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#fragment",
                      "pattern": "^$|^#.*$"
                    },
                    "host": {
                      "type": "string",
                      "description": "The new host name for the request.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#host"
                    },
                    "password": {
                      "type": "string",
                      "description": "The new password for the request.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#password"
                    },
                    "path": {
                      "type": "string",
                      "description": "The new path for the request. If empty, the existing path is cleared.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#path"
                    },
                    "port": {
                      "type": "string",
                      "description": "The new port for the request. If empty, the existing port is cleared.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#port"
                    },
                    "scheme": {
                      "$comment": "TODO: Require host when extension scheme is used.",
                      "description": "The new scheme for the request. Allowed values are \"http\", \"https\", and the scheme of the extension, for example, \"moz-extension\" in Firefox or \"chrome-extension\" in Chrome. When the extension scheme is used, the host must be specified to generate a meaningful redirection target.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#scheme",
                      "anyOf": [
                        {
                          "const": "http"
                        },
                        {
                          "const": "https"
                        },
                        {
                          "const": "moz-extension"
                        },
                        {
                          "const": "chrome-extension"
                        },
                        {
                          "$comment": "allow for other extension schemes",
                          "type": "string"
                        }
                      ]
                    },
                    "username": {
                      "type": "string",
                      "description": "The new username for the request.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#username"
                    }
                  }
                },
                "url": {
                  "type": "string",
                  "description": "The redirect URL. Redirects to JavaScript URLs are not allowed.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/Redirect#url"
                }
              },
              "oneOf": [
                {
                  "properties": {
                    "query": {
                      "$comment": "https://regexr.com/8b9j4",
                      "type": "string",
                      "description": "The new query for the request. Should be either empty, in which case the existing query is cleared; or should begin with '?'.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#query",
                      "pattern": "^$|^\\?(?:[^&]*&)*$"
                    }
                  }
                },
                {
                  "properties": {
                    "queryTransform": {
                      "description": "An object describing how to add, remove, or replace query key-value pairs.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#queryTransform",
                      "type": "object",
                      "properties": {
                        "addOrReplaceParams": {
                          "description": "An array of objects describing the list of query key-value pairs to be added or replaced.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#adddorreplaceparams",
                          "items": {
                            "type": "object",
                            "properties": {
                              "key": {
                                "type": "string",
                                "description": "The key to add or replace in the query.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#key"
                              },
                              "replaceOnly": {
                                "oneOf": [
                                  {
                                    "const": true,
                                    "description": "The query key is replaced only if it's already present.https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#replaceonly"
                                  },
                                  {
                                    "const": false,
                                    "description": "The key is also added if it's missing.https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#replaceonly"
                                  }
                                ],
                                "default": false
                              },
                              "value": {
                                "$comment": "The value value??",
                                "type": "string",
                                "description": "The value value.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#value"
                              }
                            }
                          }
                        },
                        "removeParams": {
                          "$ref": "#/definitions/stringArray",
                          "description": "The list of query keys to be removed.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/URLTransform#removeparams"
                        }
                      }
                    }
                  }
                }
              ]
            }
          }
        },
        "else": {
          "if": {
            "properties": {
              "type": {
                "const": "modifyHeaders"
              }
            }
          }
        },
        "properties": {
          "type": {
            "type": "string",
            "anyOf": [
              {
                "enum": [
                  "redirect",
                  "modifyHeaders"
                ],
                "description": "The type of action to perform.The use of the \"redirect\" and \"modifyHeaders\" actions require host permissions for the request and request initiator. Without these permissions, matching rules are ignored.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleAction#type_2"
              },
              {
                "enum": [
                  "block",
                  "upgradeScheme"
                ],
                "description": "The type of action to perform. The \"block\" and \"upgradeScheme\" actions require host permissions for the request and request initiator unless the \"declarativeNetRequest\" permission is specified. Without these permissions, matching rules are ignored.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleAction#type_2"
              },
              {
                "enum": [
                  "block",
                  "redirect",
                  "allow",
                  "upgradeScheme",
                  "modifyHeaders",
                  "allowAllRequests"
                ],
                "description": "The type of action to perform.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/RuleAction#type_2"
              }
            ]
          },
          "requestHeaders": {
            "type": "object",
            "description": "The request or response header to modify for a request\nEach object describes one header modification. To modify multiple headers, multiple objects can be specified in these arrays, or across multiple rules.\nMatching modifyHeaders rules are applied in the order described at Matching precedence. Within each extension, all modifyHeaders rules with a priority lower than or equal to matching allow or allowAllRequests rules are ignored.\nIf multiple modifyHeaders rules specify the same header, the resulting modification for the header is determined based on the priority of each rule and the operations specified:\n\nIf a rule has been appended to a header, then lower-priority rules can only append to that header. set and remove operations are not permitted.\nIf a rule has set a header, lower priority rules cannot modify the header except for append rules from the same extension.\nIf a rule has removed a header, lower priority rules cannot modify the header.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ModifyHeaderInfo",
            "required": ["header", "operation"],
            "properties": {
              "header": {
                "anyOf": [
                  {
                    "type": "string",
                    "description": "The name of the header to be modified.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ModifyHeaderInfo#header"
                  },
                  {
                    "$ref": "#/definitions/chromeAppendableHeader"
                  }
                ]
              },
              "operation": {
                "type": "string",
                "description": "The operation to be performed on a header.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ModifyHeaderInfo#operation",
                "enum": ["append", "set", "remove"]
              }
            },
            "if": {
              "not": {
                "properties": {
                  "operation": {
                    "const": "remove"
                  }
                }
              }
            },
            "then": {
              "properties": {
                "value": {
                  "type": "string",
                  "description": "The new value for the header. Must be specified for append and set operations.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ModifyHeaderInfo#value"
                }
              },
              "if": {
                "properties": {
                  "operation": {
                    "const": "append"
                  },
                  "header": {
                    "not": {
                      "$ref": "#/definitions/chromeAppendableHeader"
                    }
                  }
                }
              },
              "then": {
                "properties": {
                  "header": {
                    "description": "The new value for the header. Must be specified for append and set operations.\n\nNote:This operation is not supported for this header by chrome. See https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ModifyHeaderInfo#header_limits.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ModifyHeaderInfo#value"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
