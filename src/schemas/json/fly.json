{
  "$schema": "http://json-schema.org/draft-07/schema",
  "definitions": {
    "services": {
      "description": "Configure the mapping of ports from the public Fly proxy to your application.\n\nYou can have:\n* **No services section**: The application has no mappings to the external internet - typically apps like databases or background job workers that talk over 6PN private networking to other apps.\n* **One services section**: One internal port mapped to one external port on the internet.\n* **Multiple services sections**: Map multiple internal ports to multiple external ports.",
      "properties": {
        "concurrency": {
          "description": "Control autoscaling metrics (connections or requests) and limits (hard and soft).",
          "properties": {
            "hard_limit": {
              "default": 25,
              "description": "When an application instance is __at__ or __over__ this number, the system will bring up another instance.",
              "type": "integer"
            },
            "soft_limit": {
              "default": 20,
              "description": "When an application instance is __at__ or __over__ this number, the system is likely to bring up another instance.",
              "type": "integer"
            },
            "type": {
              "default": "connections",
              "enum": ["connections", "requests"],
              "type": "string",
              "x-taplo": {
                "docs": {
                  "enumValues": [
                    "Autoscale based on number of concurrent connections",
                    "Autoscale based on number of concurrent requests"
                  ]
                }
              }
            }
          },
          "type": "object"
        },
        "http_checks": {
          "description": "HTTP-based health checks run against the `internal_port`. These checks will pass when receiving a 2xx response. Any other response is considered a failure.",
          "items": {
            "properties": {
              "grace_period": {
                "description": "The time to wait after a VM starts before checking its health. Units are milliseconds unless you specify them like `10s` or `1m`.",
                "type": "string"
              },
              "headers": {
                "description": "Set key/value pairs of HTTP headers to pass along with the check request.",
                "type": "object"
              },
              "interval": {
                "description": "Length of the pause between connectivity checks. Units are milliseconds unless you specify them like `10s` or `1m`.",
                "type": "string"
              },
              "method": {
                "description": "The HTTP method to be used for the check.",
                "type": "string"
              },
              "path": {
                "description": "The path of the URL to be requested.",
                "type": "string"
              },
              "protocol": {
                "description": "The protocol to be used (`http` or `https`)",
                "enum": ["http", "https"],
                "type": "string"
              },
              "restart_limit": {
                "default": 0,
                "description": "The number of consecutive check failures to allow before attempting to restart the VM. The default is `0`, which disables restarts based on failed health checks.",
                "type": "integer"
              },
              "timeout": {
                "description": "The maximum time a connection can take before being reported as failing its healthcheck. Units are milliseconds unless you specify them like `10s` or `1m`.",
                "type": "string"
              },
              "tls_skip_verify": {
                "default": false,
                "description": "When set to `true` (and `protocol` is set to `https`), skip verifying the certificates sent by the server.",
                "type": "boolean"
              }
            },
            "type": "object"
          },
          "type": "array",
          "x-taplo": {
            "links": {
              "key": "https://fly.io/docs/reference/configuration/#services-http_checks"
            }
          }
        },
        "internal_port": {
          "default": 8080,
          "description": "The port this application listens on to communicate with clients. The default is 8080. We recommend applications use the default.",
          "type": "integer"
        },
        "ports": {
          "description": "For each external port you want to accept connections on, add a `ports` section.",
          "items": {
            "properties": {
              "force_https": {
                "description": "Force HTTP connections to HTTPS. `force_https` requires the `http` handler in the `handlers` section.",
                "type": "boolean"
              },
              "handlers": {
                "description": "An array of strings that select handlers to terminate the connection at the edge.\n\nValid options: http, tls, proxy_proto.",
                "items": {
                  "enum": ["http", "tls", "proxy_proto"],
                  "minLength": 1,
                  "type": "string"
                },
                "type": "array",
                "x-taplo": {
                  "links": {
                    "key": "https://fly.io/docs/reference/services/#connection-handlers"
                  }
                }
              },
              "port": {
                "default": 8080,
                "description": "The port to accept traffic on. Valid ports: 1-65535",
                "type": "integer"
              }
            },
            "type": "object"
          },
          "type": "array"
        },
        "protocol": {
          "description": "The protocol used to communicate with your application. Can be: `tcp` or `udp`.",
          "enum": ["tcp", "udp"],
          "type": "string"
        },
        "script_checks": {
          "deprecated": true,
          "description": "Health checks that run as one-off commands directly on the VM.\n\nThis type of check is **deprecated**. See `tcp_checks` or `http_checks` for alternatives."
        },
        "tcp_checks": {
          "description": "Basic TCP connection health checks. This is the default check that runs against the configured `internal_port`.",
          "items": {
            "properties": {
              "grace_period": {
                "description": "The time to wait after a VM starts before checking its health. Units are milliseconds unless you specify them like `10s` or `1m`.",
                "type": "string"
              },
              "interval": {
                "description": "Length of the pause between connectivity checks. Units are milliseconds unless you specify them like `10s` or `1m`.",
                "type": "string"
              },
              "restart_limit": {
                "default": 0,
                "description": "The number of consecutive TCP check failures to allow before attempting to restart the VM. The default is `0`, which disables restarts based on failed TCP health checks.",
                "type": "integer"
              },
              "timeout": {
                "description": "The maximum time a connection can take before being reported as failing its healthcheck. Units are milliseconds unless you specify them like `10s` or `1m`.",
                "type": "string"
              }
            },
            "type": "object"
          },
          "type": "array",
          "x-taplo": {
            "links": {
              "key": "https://fly.io/docs/reference/configuration/#services-tcp_checks"
            }
          }
        }
      },
      "type": "object"
    },
    "statics": {
      "additionalProperties": false,
      "properties": {
        "guest_path": {
          "description": "The path inside your container where the assets to serve are located.",
          "type": "string"
        },
        "url_prefix": {
          "description": "The URL prefix that should serve the static assets.",
          "type": "string"
        }
      },
      "required": ["guest_path", "url_prefix"],
      "type": "object"
    }
  },
  "description": "https://fly.io/docs/reference/configuration",
  "properties": {
    "additionalProperties": true,
    "app": {
      "description": "Fly.io application name",
      "type": "string"
    },
    "build": {
      "description": "Build configuration options. See docs at https://fly.io/docs/reference/builders.",
      "properties": {
        "additionalProperties": false,
        "args": {
          "description": "Build arguments passed to both Dockerfile and Buildpack builds. These arguments are **not available** on VMs at runtime.\n```toml\n[build.args]\n  USER = \"julieta\"\n  MODE = \"production\"\n```",
          "items": {
            "type": "object"
          },
          "type": "array"
        },
        "build-target": {
          "description": "Specify the target stage for [multistage Dockerfile builds](https://docs.docker.com/develop/develop-images/multistage-build/).",
          "type": "string"
        },
        "builder": {
          "description": "Builder Docker image to be used with the 'buildpacks' option",
          "type": "string"
        },
        "buildpacks": {
          "description": "Buildpacks to be run by the 'builder' Docker image",
          "items": {
            "minLength": 1,
            "type": "string"
          },
          "minItems": 1,
          "type": "array",
          "uniqueItems": true
        },
        "dockerfile": {
          "description": "Dockerfile used for builds. Defaults to './Dockerfile'",
          "type": "string"
        },
        "image": {
          "description": "Docker image to be deployed (skips the build process)",
          "type": "string"
        }
      },
      "type": "object"
    },
    "deploy": {
      "additionalProperties": false,
      "properties": {
        "release_command": {
          "description": "Command to run after a build, with access to the production environment, but before deployment. Non-zero exit status will abort the deployment.\n\n```toml\n[deploy]\n  release_command =\"bundle exec rails db:migrate\"\n```",
          "type": "string",
          "x-taplo": {
            "initKeys": ["importantKey"],
            "links": {
              "key": "https://fly.io/docs/reference/configuration/#release_command"
            }
          }
        },
        "strategy": {
          "default": "canary",
          "description": "Strategy for replacing VMs during a deployment.",
          "enum": ["canary", "rolling", "bluegreen", "immediate"],
          "type": "string",
          "x-taplo": {
            "docs": {
              "defaultValue": "Default is 'canary': boot a single, new VM with the new release, verify its health, then proceed with a rolling restart strategy.",
              "enumValues": [
                "This default strategy - for apps without volumes - will boot a single, new VM with the new release, verify its health, then proceed with a rolling restart strategy.",
                "One by one, each running VM is taken down and replaced by a new release VM. This is the default strategy for apps with volumes.",
                "For every running VM, a new one is booted alongside it. All new VMs must pass health checks to complete deployment, when traffic gets migrated to new VMs. If your app has multiple VMs, this strategy may reduce deploy time and downtime, assuming your app is scaled to 2 or more VMs.",
                "Replace all VMs with new releases immediately without waiting for health checks to pass. This is useful in emergency situations where you're confident a release will be healthy."
              ],
              "main": "Strategy for replacing VMs during a deployment."
            },
            "links": {
              "key": "https://fly.io/docs/reference/configuration/#strategy"
            }
          }
        }
      },
      "type": "object"
    },
    "env": {
      "additionalProperties": {
        "type": "string"
      },
      "description": "Set non-sensitive information as environment variables in the application's [runtime environment](https://fly.io/docs/reference/runtime-environment/).\nFor sensitive information, such as credentials or passwords, use the [secrets command](https://fly.io/docs/reference/secrets). For anything else though, the `env` section provides a simple way to set environment variables. Here's an example:\n```toml\n[env]\n  LOG_LEVEL = \"debug\"\n  S3_BUCKET = \"my-bucket\"\n```",
      "type": "object"
    },
    "experimental": {
      "description": "Flags and features that are subject to change, deprecation or promotion to the main configuration.",
      "properties": {
        "auto_rollback": {
          "description": "Failed deployments should roll back automatically to the previous successfully deployed release. Defaults to `true`",
          "type": "boolean"
        },
        "cmd": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Override the server command (CMD) set by the Dockerfile. Specify as an array of strings:\n\n```toml\ncmd = [\"path/to/command\", \"arg1\", \"arg2\"]\n```"
        },
        "entrypoint": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Override the ENTRYPOINT set by the Dockerfile. Specify as an array of strings:\n\n```toml\nentrypoint = [\"path/to/command\", \"arg1\", \"arg2\"]\n```"
        },
        "private_network": {
          "default": true,
          "description": "Enables private network access to the Fly organization. Defaults to `true`.",
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "kill_signal": {
      "description": "Signal to send to a process to shut it down gracefully. Default is SIGINT.",
      "enum": [
        "SIGINT",
        "SIGTERM",
        "SIGQUIT",
        "SIGUSR1",
        "SIGUSR2",
        "SIGKILL",
        "SIGSTOP"
      ],
      "type": "string"
    },
    "kill_timeout": {
      "description": "Seconds to wait before forcing a VM process to exit. Default is 5 seconds.",
      "type": "integer"
    },
    "mounts": {
      "additionalProperties": false,
      "description": "Mount [persistent storage volumes](https://fly.io/docs/reference/volumes) previously setup via `flyctl`. Both settings are required. Example:\n\n```toml\n[mounts]\n  source = \"myapp_data\"\n  destination = \"/data\"\n```",
      "properties": {
        "destination": {
          "description": "The path at which the `source` volume should be mounted in the running app VM.",
          "type": "string"
        },
        "source": {
          "description": "The name of the volume to mount as shown in `fly volumes list`.\n\nA volume of this name *must exist* in each of the app regions. If there's more than one volume in the target region with the same one, one will be picked randomly.",
          "type": "string"
        }
      },
      "required": ["source", "destination"],
      "type": "object",
      "x-taplo": {
        "links": {
          "key": "https://fly.io/docs/reference/configuration/#the-mounts-section"
        }
      }
    },
    "services": {
      "oneOf": [
        {
          "$ref": "#/definitions/services"
        },
        {
          "items": {
            "$ref": "#/definitions/services"
          },
          "type": "array"
        }
      ]
    },
    "statics": {
      "anyOf": [
        {
          "$ref": "#/definitions/statics"
        },
        {
          "items": {
            "$ref": "#/definitions/statics"
          },
          "type": "array"
        }
      ],
      "description": "The `statics` sections expose static assets built into your application's container to Fly's Anycast network. You can serve HTML files, Javascript, and images without needing to run a web server inside your container.",
      "x-taplo": {
        "links": {
          "key": "https://fly.io/docs/reference/configuration/#the-statics-sections"
        }
      }
    }
  },
  "title": "Fly.io config schema (fly.toml)",
  "type": "object",
  "x-taplo-info": {
    "authors": ["Joshua Sierles (https://github.com/jsierles)"],
    "patterns": ["\\.*fly(.*)?\\.toml?$"]
  }
}
