{
  "$comment": "Schema derived from https://raw.githubusercontent.com/dotnet/core/main/release-notes/releases-index.json and https://github.com/dotnet/deployment-tools/blob/main/src/Microsoft.Deployment.DotNet.Releases/src/Product.cs",
  "$schema": "http://json-schema.org/draft-04/schema",
  "additionalProperties": false,
  "definitions": {
    "dateYYYYMMDD": {
      "$comment": "If we targeted draft-07 we could use the 'date' format instead of this format pattern. We cannot use the 'date-time' format because our existing values don't validate against it.",
      "description": "A date in the format YYYY-MM-DD",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
      "type": "string"
    },
    "product": {
      "additionalProperties": false,
      "properties": {
        "channel-version": {
          "description": "The version of the product, e.g '5.0' or '1.1'",
          "pattern": "^[0-9]+\\.[0-9]+$",
          "title": "ProductVersion",
          "type": "string"
        },
        "eol-date": {
          "description": "The end-of-life (EOL) date for this Product when it is considered to be out of support. The value may be `null` if the EOL date is undetermined, e.g. when a product is still a prerelease.",
          "oneOf": [
            {
              "$ref": "#/definitions/dateYYYYMMDD"
            },
            {
              "type": "null"
            }
          ],
          "title": "EndOfLifeDate"
        },
        "latest-release": {
          "$ref": "#/definitions/releaseVersion",
          "description": "The version of the latest release",
          "title": "LatestReleaseVersion"
        },
        "latest-release-date": {
          "$ref": "#/definitions/dateYYYYMMDD",
          "description": "The date of the latest release of this product.",
          "title": "LatestReleaseDate"
        },
        "latest-runtime": {
          "$ref": "#/definitions/releaseVersion",
          "description": "The version of the runtime included in the latest release",
          "title": "LatestRuntimeVersion"
        },
        "latest-sdk": {
          "$ref": "#/definitions/releaseVersion",
          "description": "The version of the SDK included in the latest release.  This is usually the SDK with the highest feature band. A ProductRelease may include multiple SDKs across different feature bands, all of which carry the same runtime version.",
          "title": "LatestSdkVersion"
        },
        "product": {
          "description": "The name of the product.",
          "title": "ProductName",
          "type": "string"
        },
        "releases.json": {
          "$comment": "Since this is always an absolute uri, the 'uri' format is unambiguous",
          "description": "The URL pointing to the releases.json file that contains information about all the releases  associated with this Product.",
          "format": "uri",
          "type": "string"
        },
        "security": {
          "description": "`true` if the latest release of this product includes a security update, `false` otherwise.",
          "title": "LatestReleaseIncludesSecurityUpdate",
          "type": "boolean"
        },
        "support-phase": {
          "$ref": "#/definitions/supportPhase",
          "description": "The support phase of the Product. For an LTS release, the `eol-date` property should be checked to confirm whether a release is still supported. The EOL dates are often published in advance, but there can be delays to updating the support phase in the published data."
        }
      },
      "required": [
        "channel-version",
        "security",
        "latest-release-date",
        "latest-release",
        "latest-runtime",
        "latest-sdk",
        "product",
        "releases.json",
        "support-phase"
      ],
      "type": "object"
    },
    "releaseVersion": {
      "description": "A SemVer-compatible version string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "type": "string"
    },
    "supportPhase": {
      "$comment": "If we targeted draft-06 we could use oneOf/const in combination to add descriptions to the enum values",
      "description": "An enumeration describing the different support phases of a product",
      "enum": [
        "current",
        "eol",
        "lts",
        "maintenance",
        "preview",
        "rc",
        "unknown"
      ],
      "type": "string"
    }
  },
  "description": "A collection of manifests for .NET products, which is updated with each preview and stable release of the .NET SDK and/or Runtime",
  "properties": {
    "releases-index": {
      "description": "A collection of all released products",
      "items": {
        "$ref": "#/definitions/product"
      },
      "type": "array"
    }
  },
  "required": ["releases-index"],
  "title": "JSON schema for .NET product collection manifests",
  "type": "object"
}
