{
  "$schema": "https://json-schema.org/draft-07/schema",
  "title": "Nexus Configuration",
  "description": "Schema for Nexus configuration files that manage workflow dependencies and configuration inheritance",
  "type": "object",
  "properties": {
      "id": {
          "type": "string",
          "pattern": "^(root|service-[a-z0-9-]+)$",
          "description": "Unique identifier for the component"
      },
      "default_execution_mode": {
          "type": "string",
          "enum": ["updated", "connected", "downstream", "complete"],
          "description": "Default execution mode that can be overridden (e.g., via commit message 'nexus:updated')"
      },
      "workflow_dispatch": {
          "type": "string",
          "description": "Local workflow to dispatch",
          "pattern": "^[a-zA-Z0-9_-]+$"
      },
      "job_name_prefix": {
          "type": "string",
          "description": "Optional prefix for job names in the workflow",
          "pattern": "^[a-zA-Z0-9_-]+$"
      },
      "uses": {
          "type": "string",
          "description": "Reusable workflow reference",
          "pattern": "^[a-zA-Z0-9_-]+/[a-zA-Z0-9_-]+@[a-zA-Z0-9_.-]+$"
      },
      "with": {
          "type": "object",
          "description": "Input parameters for the workflow",
          "additionalProperties": {
              "oneOf": [
                  {"type": "string"},
                  {"type": "number"},
                  {"type": "boolean"}
              ]
          }
      },
      "dependency": {
          "type": "object",
          "description": "Component dependencies",
          "properties": {
              "after": {
                  "type": "array",
                  "items": {"type": "string"},
                  "description": "Components that must complete before this one"
              },
              "before": {
                  "type": "array",
                  "items": {"type": "string"},
                  "description": "Components that depend on this one"
              },
              "id": {
                  "type": "array",
                  "items": {"type": "string"},
                  "description": "Direct component dependencies"
              }
          },
          "additionalProperties": false
      },
      "variables": {
          "type": "object",
          "description": "Configuration variables",
          "additionalProperties": {
              "oneOf": [
                  {"type": "string"},
                  {"type": "number"},
                  {"type": "boolean"},
                  {"type": "object"},
                  {"type": "array"}
              ]
          }
      }
  },
  "required": ["id"],
  "additionalProperties": false,
  "oneOf": [
      {
          "title": "Root Configuration",
          "properties": {
              "id": {"const": "root"},
              "default_execution_mode": {"type": "string"}
          },
          "required": ["id", "default_execution_mode"]
      },
      {
          "title": "Component Configuration",
          "properties": {
              "id": {"not": {"const": "root"}}
          },
          "anyOf": [
              {
                  "title": "Local Workflow",
                  "required": ["workflow_dispatch"]
              },
              {
                  "title": "Reusable Workflow",
                  "required": ["uses"]
              }
          ]
      }
  ]
}
