{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "definitions": {
    "createOptions": {
      "contentMediaType": "application/json",
      "type": "string"
    },
    "env": {
      "additionalProperties": false,
      "patternProperties": {
        "^[^\\+#$\\s\\.]+$": {
          "properties": {
            "value": {
              "type": ["number", "string", "boolean"]
            }
          },
          "required": ["value"],
          "type": "object"
        }
      },
      "type": "object"
    },
    "moduleSettings": {
      "properties": {
        "createOptions": {
          "$ref": "#/definitions/createOptions"
        },
        "image": {
          "examples": ["mcr.microsoft.com/azureiotedge-agent:1.0"],
          "type": "string"
        }
      },
      "required": ["image"],
      "type": "object"
    },
    "moduleType": {
      "enum": ["docker"]
    },
    "restartPolicy": {
      "enum": ["never", "on-failure", "on-unhealthy", "always"]
    },
    "status": {
      "enum": ["running", "stopped"]
    }
  },
  "properties": {
    "$edgeAgent": {
      "properties": {
        "properties.desired": {
          "properties": {
            "modules": {
              "additionalProperties": false,
              "patternProperties": {
                "^[a-zA-Z0-9_-]+$": {
                  "properties": {
                    "env": {
                      "$ref": "#/definitions/env"
                    },
                    "restartPolicy": {
                      "$ref": "#/definitions/restartPolicy"
                    },
                    "settings": {
                      "$ref": "#/definitions/moduleSettings"
                    },
                    "status": {
                      "$ref": "#/definitions/status"
                    },
                    "type": {
                      "$ref": "#/definitions/moduleType"
                    },
                    "version": {
                      "examples": ["1.0"],
                      "type": "string"
                    }
                  },
                  "required": ["type", "status", "restartPolicy", "settings"],
                  "type": "object"
                }
              },
              "type": "object"
            },
            "runtime": {
              "properties": {
                "settings": {
                  "properties": {
                    "loggingOptions": {
                      "type": "string"
                    },
                    "minDockerVersion": {
                      "examples": ["v1.25"],
                      "type": "string"
                    },
                    "registryCredentials": {
                      "additionalProperties": false,
                      "patternProperties": {
                        "^.+$": {
                          "properties": {
                            "address": {
                              "pattern": "^[^\\s]+$",
                              "type": "string"
                            },
                            "password": {
                              "type": "string"
                            },
                            "username": {
                              "type": "string"
                            }
                          },
                          "required": ["username", "password", "address"],
                          "type": "object"
                        }
                      },
                      "type": "object"
                    }
                  },
                  "type": "object"
                },
                "type": {
                  "$ref": "#/definitions/moduleType"
                }
              },
              "required": ["type", "settings"],
              "type": "object"
            },
            "schemaVersion": {
              "pattern": "1.0",
              "type": "string"
            },
            "systemModules": {
              "additionalProperties": false,
              "properties": {
                "edgeAgent": {
                  "properties": {
                    "env": {
                      "$ref": "#/definitions/env"
                    },
                    "settings": {
                      "$ref": "#/definitions/moduleSettings"
                    },
                    "type": {
                      "$ref": "#/definitions/moduleType"
                    }
                  },
                  "required": ["type", "settings"],
                  "type": "object"
                },
                "edgeHub": {
                  "properties": {
                    "env": {
                      "$ref": "#/definitions/env"
                    },
                    "restartPolicy": {
                      "$ref": "#/definitions/restartPolicy"
                    },
                    "settings": {
                      "$ref": "#/definitions/moduleSettings"
                    },
                    "status": {
                      "$ref": "#/definitions/status"
                    },
                    "type": {
                      "$ref": "#/definitions/moduleType"
                    }
                  },
                  "required": ["type", "settings", "status", "restartPolicy"],
                  "title": "The Edgehub Schema",
                  "type": "object"
                }
              },
              "required": ["edgeAgent", "edgeHub"],
              "type": "object"
            }
          },
          "required": ["schemaVersion", "runtime", "systemModules", "modules"],
          "type": "object"
        }
      },
      "required": ["properties.desired"],
      "title": "Configuration for the edgeAgent module",
      "type": "object"
    }
  },
  "required": ["$edgeAgent"],
  "title": "JSON schema for Azure IoT EdgeAgent Deployment version 1.0",
  "type": "object"
}
